<!DOCTYPE html>
<html dir="ltr" lang="lt-LT">
<head>
	<meta charset="UTF-8" />

	<title>
		 &raquo; Noriu savo struktūros WordPress’e - 		Užduodu klausimus, neriu tinklus			</title>

	<meta name="generator" content="WordPress 2.9.2" /> <!-- leave this for stats -->

	<link rel="stylesheet" href="https://www.dominykas.lt/wp-content/themes/dominykas.com.5/style.css" type="text/css" />
	<link rel="pingback" href="https://www.dominykas.lt/xmlrpc.php" />
	<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Feed" href="https://www.dominykas.lt/index.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Comments Feed" href="https://www.dominykas.lt/comments.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Noriu savo struktūros WordPress’e Comments Feed" href="https://www.dominykas.lt/2007/12/noriu-savo-strukturos-wordpresse.rss2.xml" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.dominykas.lt/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.dominykas.lt/wp-includes/wlwmanifest.xml" />
<link rel='index' title='Užduodu klausimus, neriu tinklus' href='https://www.dominykas.lt' />
<link rel='start' title='Labas, pasauli!' href='https://www.dominykas.lt/2007/12/labas-pasauli.html' />
<link rel='prev' title='Noriu blog&#8217;o adresų struktūros' href='https://www.dominykas.lt/2007/12/noriu-blogo-adresu-strukturos.html' />
<link rel='next' title='Scott Jenson &#8211; The Simplicity Shift' href='https://www.dominykas.lt/2007/12/scott-jenson-the-simplicity-shift.html' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel='canonical' href='https://www.dominykas.lt/2007/12/noriu-savo-strukturos-wordpresse.html' />

	<link rel="openid.server" href="http://openid.claimid.com/server" />
	<link rel="openid.delegate" href="http://openid.claimid.com/dominykas" />

<!--[if IE]>
<script src="https://www.dominykas.lt/wp-content/themes/dominykas.com.5/images/html5.js" type="text/javascript"></script>
<![endif]-->

</head>
<body><div id="page">

<header role="banner" id="banner">
	<hgroup>
		<h1><a href="https://www.dominykas.lt/">Užduodu klausimus, neriu tinklus</a></h1>
		<h2>Dominykas Blyžė turi blog&#039;ą</h2>
	</hgroup>
</header>

<nav id="sidebar">

			<section id="recent-posts-2" class="widget widget_recent_entries">		<h1>Recent Posts</h1>		<ul>
				<li><a href="https://www.dominykas.lt/2013/02/robots-txt-mitai-ir-neteisingas-naudojimas.html" title="robots.txt mitai ir neteisingas naudojimas">robots.txt mitai ir neteisingas naudojimas </a></li>
				<li><a href="https://www.dominykas.lt/2012/11/ateikit-i-vilnius-js-susitikima.html" title="Ateikit į Vilnius JS susitikimą">Ateikit į Vilnius JS susitikimą </a></li>
				<li><a href="https://www.dominykas.lt/2012/04/ateikit-i-infoshow-web-konferencija-2012.html" title="Ateikit į InfoShow WEB konferenciją 2012">Ateikit į InfoShow WEB konferenciją 2012 </a></li>
				<li><a href="https://www.dominykas.lt/2011/12/ispudziai-is-diskusijos-apie-internetini-balsavima.html" title="Įspūdžiai iš diskusijos apie internetinį balsavimą">Įspūdžiai iš diskusijos apie internetinį balsavimą </a></li>
				<li><a href="https://www.dominykas.lt/2011/03/savaitgalio-eksperimentas-login-2011-programa-pritaikyta-mobiliems-telefonams.html" title="Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams">Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams </a></li>
				</ul>
		</section><section id="linkcat-129" class="widget widget_links"><h1>Kiti mano dalykai</h1>
	<ul class='xoxo blogroll'>
<li><a href="http://www.dominykas.com/" rel="me">Blog In English</a></li>
<li><a href="https://github.com/h5o" rel="me">HTML5 santraukų generatorius</a></li>
<li><a href="http://code.dominykas.com/" rel="me">Truputis JS/CSS/PHP kodo</a></li>
<li><a href="http://twitter.com/dymonaz" rel="me">Twitter</a></li>

	</ul>
</section>
<section id="archives-2" class="widget widget_archive"><h1>Archyvas</h1>		<ul>
			<li><a href='https://www.dominykas.lt/2013/02/' title='February 2013'>February 2013</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2012/11/' title='November 2012'>November 2012</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2012/04/' title='April 2012'>April 2012</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2011/12/' title='December 2011'>December 2011</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2011/03/' title='March 2011'>March 2011</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2011/02/' title='February 2011'>February 2011</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2010/09/' title='September 2010'>September 2010</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2010/03/' title='March 2010'>March 2010</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2010/01/' title='January 2010'>January 2010</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2009/12/' title='December 2009'>December 2009</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2009/11/' title='November 2009'>November 2009</a>&nbsp;(2)</li>
	<li><a href='https://www.dominykas.lt/2009/10/' title='October 2009'>October 2009</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2009/08/' title='August 2009'>August 2009</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2009/07/' title='July 2009'>July 2009</a>&nbsp;(3)</li>
	<li><a href='https://www.dominykas.lt/2009/06/' title='June 2009'>June 2009</a>&nbsp;(3)</li>
	<li><a href='https://www.dominykas.lt/2009/03/' title='March 2009'>March 2009</a>&nbsp;(5)</li>
	<li><a href='https://www.dominykas.lt/2009/02/' title='February 2009'>February 2009</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2009/01/' title='January 2009'>January 2009</a>&nbsp;(3)</li>
	<li><a href='https://www.dominykas.lt/2008/11/' title='November 2008'>November 2008</a>&nbsp;(2)</li>
	<li><a href='https://www.dominykas.lt/2008/08/' title='August 2008'>August 2008</a>&nbsp;(1)</li>
	<li><a href='https://www.dominykas.lt/2008/06/' title='June 2008'>June 2008</a>&nbsp;(2)</li>
	<li><a href='https://www.dominykas.lt/2008/05/' title='May 2008'>May 2008</a>&nbsp;(2)</li>
	<li><a href='https://www.dominykas.lt/2008/04/' title='April 2008'>April 2008</a>&nbsp;(5)</li>
	<li><a href='https://www.dominykas.lt/2008/03/' title='March 2008'>March 2008</a>&nbsp;(9)</li>
	<li><a href='https://www.dominykas.lt/2008/02/' title='February 2008'>February 2008</a>&nbsp;(2)</li>
	<li><a href='https://www.dominykas.lt/2008/01/' title='January 2008'>January 2008</a>&nbsp;(11)</li>
	<li><a href='https://www.dominykas.lt/2007/12/' title='December 2007'>December 2007</a>&nbsp;(12)</li>
		</ul>
</section>
</nav>
<section id="content" role="main">


	    <article class="post singular" id="post-10">
	<header class="clearfix">
		<h1><a href="https://www.dominykas.lt/2007/12/noriu-savo-strukturos-wordpresse.html" rel="bookmark">Noriu savo struktūros WordPress’e</a></h1>
		<ul>
			<li><time datetime="2007-12-17T19:10:46+00:00">2007 December 17</time></li>
					</ul>
	</header>

	<div class="postbody">
	<p><a href="http://code.dominykas.com/php/wordpress/canonizer/">Nustok burną aušint, Dominykai, ir duok <i>source&#8217;ą</i></a>.</p>
<p>Sugalvojus <a href="https://www.dominykas.lt/2007/12/noriu-padorios-adresu-strukturos.html">pricipą</a>, išplėtojus <a href="https://www.dominykas.lt/2007/12/noriu-pastovios-adresu-ir-turinio-strukturos.html">idėją</a> ir apibrėžus <a href="https://www.dominykas.lt/2007/12/noriu-blogo-adresu-strukturos.html">taisykles</a> galima žiūrėti dar konkrečiau. Turint omeny mano visus princesiškus įgeidžius, WordPress šiaip jau nėra bloga sistema, nors kodo kiekis skirtas adresų generavimui ir jų apdorojimui yra stulbinantis (ir netgi isteriškai juokingas). Tačiau čia jau jų pačių problema, kylanti iš to, kad siekiama patenkinti kuo didesnį vartotojų ratą. Tačiau liaudies išmintis teigia ką kitą &#8211; <em>kartais kas tinka viskam &#8211; netinka niekam</em>. Na bent jau man tikrai <strong>netinka masinio vartojimo produktas</strong>, kuris netenkina mano poreikių. Tačiau WP yra atviro kodo ir šiaip jau tiesiog <strong>prašosi laužomas</strong> ir &#8220;pritaikomas&#8221; &#8211; kaina viso to be abejo yra tai, kad ateityje mano &#8220;perrašymai&#8221; gali nebeveikti ir teks prie jų padirbėti sulig kiekvienu WP relyzu, tačiau vieną kartą pasidarius taip kaip aš noriu &#8211; turėčiau būti patenkintas gana ilgai, net su sena WP versija &#8211; don&#8217;t fix it, if it ain&#8217;t broken.<br />
<span id="more-10"></span></p>
<h2>Užduotis</h2>
<p>Mano tikslas yra priversti WP atpažinti adresus, pagal mano struktūrą, priversti jį generuoti adresus pagal mano struktūrą ir priversti jį padaryti 301 redirektą, kai adresas netenkina struktūros. Kadangi nežinau iki galo visų galimybių, kurias naudosiu, be to ir laikas ribotas &#8211; kol kas užteks sutvarkyti šitaip:</p>
<ul>
<li><b>Turinys (content):</b>
<ul>
<li><b>/2007/</b> &#8211; mėnesių sąrašas [Archyvas, 2007]
<ul>
<li><b>01-12/</b> &#8211; post&#8217;ų sąrašas [Archyvas, 2007, mėnuo]
<ul>
<li>postas-numeris-vienas.html</li>
<li>postas-numeris-vienas.(rss|atom|rdf|rss2).xml</li>
<li>postas-numeris-vienas.trackback</li>
</ul>
</li>
</ul>
</li>
<li><b>/pavadinimas.html</b> &#8211; paprastas puslapis (analogiškai postams &#8211; rss ir tb)</li>
<li><b>/attachments/2007/11/pavadinimas.html</b> &#8211; prisegto failo aprašymas (analogiškai postams &#8211; rss ir tb)</li>
</ul>
</li>
<li><b>Archyvai:</b>
<ul>
<li><b>kategorijos/</b> &#8211; kategorijų sąrašas
<ul>
<li>pavadinimas[/subpavadinimas].html &#8211; paskutiniai X įrašų kategorijoje</li>
<li>pavadinimas[/subpavadinimas].(rss|atom|rdf|rss2).xml &#8211; kategorijos feed&#8217;as</li>
</ul>
</li>
<li><b>tagai/</b> &#8211; tagų debesėlis
<ul>
<li>pavadinimas.html</li>
<li>pavadinimas.(rss|atom|rdf|rss2).xml</li>
</ul>
</li>
</ul>
</li>
<li><b>Visa kita</b> &#8211; filtruojasi per standartinius WP GET parametrus, kreipiantis į /search. Visą /search tuo pačiu įdedame į noindex, nes ten bus dinamiškas, pasikartojantis ir visaip kitaip paieškos robotams nenaudingas turinys &#8211; pažangūs vartotojai patys susigaudys kaip išgauti tai ko nori.</li>
</ul>
<h2>Kur ieškoti?</h2>
<p>WordPress filosofija <a href="http://codex.wordpress.org/Plugin_API/Filter_Reference">leidžia filtruoti</a> beveik visą įmanomą išvedimą &#8211; tai bene labiausiai palengvina mano darbą. Problema aišku ta, kad visi tie filtrai gana prastai dokumentuoti ir nėra patogios <i>naming convention</i>, todėl teks verstis su elementaria paieška kode.</p>
<p>Perrašymas susideda iš trijų dalių &#8211; turinio atpažinimo iš URL, nuorodų generavimo ir nuorodų kanonizavimo. Atpažinimą susitvarkyti gana paprasta &#8211; reikia detaliai išsianalizuoti <code>wp-includes/rewrite.php</code> failą ir ką jis veikia, po to sukurti savo <i>regular expressions</i>. Nuorodų generavime beveik visur (išskyrus puslapiavimą paieškoje ir pan.) yra naudojami <code>apply_filter</code> &#8211; per visą WP <i>source&#8217;ą</i> paleidus paieškas <code>_link(</code> ir <code>_url(</code>, po to truputį padirbėjus galima susirinkti visus reikalingus filtrus (nes dokumentacija pasitikėti kažko sunku).</p>
<p>Kanonizavimas yra iš esmės paprastas &#8211; jeigu rodomas objektas (puslapis, archyvas, pan.) yra kviečiamas ne su kanonine nuorodą &#8211; darom 301 redirektą. Panašiai elgiasi standartinė WP kanonizacija (<code>wp-includes/canonical.php</code>), tačiau ji neveikia su <i>feed&#8217;ais</i> ir (pagal mano reikalavimus) neperkelia lankytojų į &#8220;/search&#8221; neindeksuojamą sritį &#8211; teks jį išjungti ir daryti savo.</p>
<h2>Rezultatas</h2>
<p>12 valandų galvos trankymo į sieną, eureka šūksnių, keiksmų, verkimo, testas su <a href="http://www.arnebrachhold.de/projects/wordpress-plugins/google-xml-sitemaps-generator/">Google Sitemaps pluginu</a>, pergalės šokis ir <a href="http://code.dominykas.com/php/wordpress/canonizer/">canonizer plugin&#8217;as paruoštas</a>. Iš esmės niekam nerekomenduoju jo naudoti &#8211; tačiau peržvelgti kodą, pažiūrėti kaip veikia mano blog&#8217;as ir galbūt dalį to pritaikyti sau &#8211; visada prašom. Į egzistuojantį blog&#8217;ą jo kelti nederėtų dėl jau minėtos adresų pasikeitimo priežasties &#8211; nesivarginau daryti <i>backwards compatibility</i> su visomis įmanomomis WP instaliacijomis, todėl jūsų senos nuorodos gali paprasčiausiai nustoti veikti. Be to plugin&#8217;as tikisi keletos nustatymų &#8211; visų pirma permalink struktūra turėtų būti <code>/%year%/%monthnum%/%postname%.html</code>; taipogi pirmasis puslapis turėtų būti įrašų sąrašas (netikrinau ar veikia kitu atveju). Na ir šiaip jis nėra pakankamai ištestuotas &#8211; laikas parodys.</p>
<p>Nepaisant to, kas yra skonio reikalas, svarbiausios veikimo detalės:</p>
<ul>
<li><code>add_action('init',array('Dominykas_Canonizer','init'));</code>
<p>Užsikraunam, pasileidžiam, važiuojam, žiūrim į klasės <code>init()</code> metodą</p>
</li>
<li><code>init()</code> viduje nematome nieko ypatingo &#8211; inicializuojami keli kintamieji ir nustatomi filtrai:
<ul>
<li><code>f_rr_*()</code> &#8211; filtruojam perrašymo taisykles. Grąžinam asiociatyvų masyvą, kurį naudoja <code>$wp_rewrite</code>. <code>f_rr()</code> tuo pačiu dar šiek tiek pravalo tai kas man neįdomu.</li>
<li><code>f_url_*()</code> &#8211; filtruojam sugeneruotus adresus. Kiekviena funkcija labai skirtinga ir su skirtingais parametrais &#8211; bet galbūt vieną dieną WP viduje įsivyraus tvarka ir gyventi bus paprasčiau&#8230; <code>f_url()</code> ištaiso puslapiavimą (kabinamės ant <code>clean_url</code>, nes kito būdo nėra) &#8211; šitą funkciją reikės perrašyti, kai apsispręsiu dėl gražios puslapių struktūros (tinkamos SEO).</li>
<li><code>redirect_canonical</code> &#8211; perkeliam lankytoją į Teisingą Adresą</li>
</ul>
</li>
<li>Dar viduje randame keletą pagalbiniu funkcijų:
<ul>
<li><code>query_allowed_only()</code> &#8211; sutikrinam ar turime tiksliai tokius ir tik tokius parametrus kaip reikalinga kanoniniam adresui</li>
<li><code>rebuild_url()</code> &#8211; quick-n-dirty hackas atstatyti adresą, kurį sugriovėme su <code>parse_url()</code></li>
</ul>
</ul>
<p>Dalis funkcijų dokumentuota, dalis gimė copy-paste būdu, o Windows kažkodėl ištrina visus komentarus iš clipboard&#8217;o (tikrai tikrai!)</p>
<h2>Kas toliau?</h2>
<p>Galbūt vieną dieną WP išaugs į padorų OO dizainą. Galbūt vieną dieną visas nuorodų generavimas bus viename faile. Tada bus galima tiesiog pakeisti $wp_rewrite ir pvz. $wp_links objektus į savo parašytus/išplėstus ir nukris dalis vargo (performance&#8217;o atžvilgiu turėtų tikrai būti efektyviau, nei du kartus atlikinėti tą patį darbą). Artimiausias dalykas though &#8211; sutvarkyti į padorią PHP5 objektinę sintaksę (static funkcijos), bei sutvarkyti, kad nuorodų atpažinimo regexpų kešas nebūtų generuojamas kas kartą (<code>$wp_rewrite-&gt;flush_rules();</code>. Vėliau jau bus galima žiūrėti šiek tiek plačiau, kad padengti daugiau WP funkcijų ir pritaikyti didesniam ratui lankytojų. Pirmas žingsnis į išleidimą viešumon, būtų permalink nustatymų pakeitimas, t.y. WP options turėtų būti galima pasirinkti ar naudoti WP permalinkus, ar naudoti šio plugino sistemą &#8211; tada jau tektų kurti ir konfigūracijos opcijas. Jeigu kas nors norite tuo užsiimti &#8211; prašau! Kodo turbūt nerašysiu, bet į klausimus kiek sugebėsiu &#8211; atsakysiu.</p>
<p>O tęsiant WP hackinimo temą, natūralus posūkis yra link skinų laužymo ir templeitų pritaikymo.</p>
	</div>

	<footer>
		<dl>
			<dt>Kategorija:</dt>
			<dd><a href="https://www.dominykas.lt/category/it/tinklo-kurimas.html" title="View all posts in Tinklo kūrimas" rel="category tag">Tinklo kūrimas</a></dd>

			<dt>Žymos:</dt> <dd><ul><li><a href="https://www.dominykas.lt/tag/blogo-pradzia.html" rel="tag">blogo pradžia</a></li><li><a href="https://www.dominykas.lt/tag/url.html" rel="tag">url</a></li><li><a href="https://www.dominykas.lt/tag/wordpress.html" rel="tag">wordpress</a></li></ul></dd>
					</dl>
	</footer>


<!-- You can start editing here. -->

<section id="comments">
	<header class="withrss">
		<h1>2 Responses to &#8220;Noriu savo struktūros WordPress’e&#8221;</h1>
		<a href="https://www.dominykas.lt/2007/12/noriu-savo-strukturos-wordpresse.rss2.xml" class="rss" title="Komentarų RSS">Komentarų RSS</a>
	</header>


		<article class="comment  alt " id="comment-49">
			<footer>
				 <img alt='QQ' src='http://www.gravatar.com/avatar/0db29f5f00cb7c16662575ea9a90bc22?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite>QQ</cite>


				<time datetime="2008-01-09T15:22:33+00:00"><a href="#comment-49" title="">
					2008 January 9 at 15:22				</a></time>
			</footer>


			<p>o kodėl? čia pas tave jau naudojama ar dar ne?</p>

		</article>



		<article class="comment  ownercomment" id="comment-51">
			<footer>
				 <img alt='Dominykas' src='http://www.gravatar.com/avatar/760ee07e2a7c2a05ac35a981276c6a29?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite><a href='https://www.dominykas.lt' rel='external nofollow' class='url'>Dominykas</a></cite>


				<time datetime="2008-01-10T11:29:46+00:00"><a href="#comment-51" title="">
					2008 January 10 at 11:29				</a></time>
			</footer>


			<p>yup. pluginas yra, stuffas naudojamas. o todėl, kad paaiškinta ankstesniuose keliuose įrašuose.</p>

		</article>


	</section>



	</article>


</section>

<footer role="contentinfo" id="contentinfo">
	<p>&copy; 2005-2008, Dominykas Blyžė.</p>
	<p>Užduodu klausimus, neriu tinklus is proudly powered by <a href="http://wordpress.org/">WordPress</a>.</p>
</footer>


</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1761312-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>
