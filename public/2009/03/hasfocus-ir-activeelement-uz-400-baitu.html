<!DOCTYPE html>
<html dir="ltr" lang="lt-LT">
<head>
	<meta charset="UTF-8" />

	<title>
		 &raquo; hasFocus ir activeElement už 400 baitų - 		Užduodu klausimus, neriu tinklus			</title>

	<meta name="generator" content="WordPress 2.9.2" /> <!-- leave this for stats -->

	<link rel="stylesheet" href="http://www.d-b.lt/wp-content/themes/dominykas.com.5/style.css" type="text/css" />
	<link rel="pingback" href="http://www.d-b.lt/xmlrpc.php" />
	<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Feed" href="http://www.d-b.lt/index.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Comments Feed" href="http://www.d-b.lt/comments.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; hasFocus ir activeElement už 400 baitų Comments Feed" href="http://www.d-b.lt/2009/03/hasfocus-ir-activeelement-uz-400-baitu.rss2.xml" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.d-b.lt/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.d-b.lt/wp-includes/wlwmanifest.xml" />
<link rel='index' title='Užduodu klausimus, neriu tinklus' href='http://www.d-b.lt' />
<link rel='start' title='Labas, pasauli!' href='http://www.d-b.lt/2007/12/labas-pasauli.html' />
<link rel='prev' title='Prieinamos svetainės žmonėms BE negalių' href='http://www.d-b.lt/2009/02/prieinamos-svetaines-zmonems-be-negaliu.html' />
<link rel='next' title='Kodėl aš myliu Operą (2)' href='http://www.d-b.lt/2009/03/kodel-as-myliu-opera-2.html' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel='canonical' href='http://www.d-b.lt/2009/03/hasfocus-ir-activeelement-uz-400-baitu.html' />

	<link rel="openid.server" href="http://openid.claimid.com/server" />
	<link rel="openid.delegate" href="http://openid.claimid.com/dominykas" />

<!--[if IE]>
<script src="http://www.d-b.lt/wp-content/themes/dominykas.com.5/images/html5.js" type="text/javascript"></script>
<![endif]-->

</head>
<body><div id="page">

<header role="banner" id="banner">
	<hgroup>
		<h1><a href="http://www.d-b.lt/">Užduodu klausimus, neriu tinklus</a></h1>
		<h2>Dominykas Blyžė turi blog&#039;ą</h2>
	</hgroup>
</header>

<nav id="sidebar">

			<section id="recent-posts-2" class="widget widget_recent_entries">		<h1>Recent Posts</h1>		<ul>
				<li><a href="http://www.d-b.lt/2013/02/robots-txt-mitai-ir-neteisingas-naudojimas.html" title="robots.txt mitai ir neteisingas naudojimas">robots.txt mitai ir neteisingas naudojimas </a></li>
				<li><a href="http://www.d-b.lt/2012/11/ateikit-i-vilnius-js-susitikima.html" title="Ateikit į Vilnius JS susitikimą">Ateikit į Vilnius JS susitikimą </a></li>
				<li><a href="http://www.d-b.lt/2012/04/ateikit-i-infoshow-web-konferencija-2012.html" title="Ateikit į InfoShow WEB konferenciją 2012">Ateikit į InfoShow WEB konferenciją 2012 </a></li>
				<li><a href="http://www.d-b.lt/2011/12/ispudziai-is-diskusijos-apie-internetini-balsavima.html" title="Įspūdžiai iš diskusijos apie internetinį balsavimą">Įspūdžiai iš diskusijos apie internetinį balsavimą </a></li>
				<li><a href="http://www.d-b.lt/2011/03/savaitgalio-eksperimentas-login-2011-programa-pritaikyta-mobiliems-telefonams.html" title="Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams">Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams </a></li>
				</ul>
		</section><section id="linkcat-129" class="widget widget_links"><h1>Kiti mano dalykai</h1>
	<ul class='xoxo blogroll'>
<li><a href="http://www.dominykas.com/" rel="me">Blog In English</a></li>
<li><a href="https://github.com/h5o" rel="me">HTML5 santraukų generatorius</a></li>
<li><a href="http://code.dominykas.com/" rel="me">Truputis JS/CSS/PHP kodo</a></li>
<li><a href="http://twitter.com/dymonaz" rel="me">Twitter</a></li>

	</ul>
</section>
<section id="archives-2" class="widget widget_archive"><h1>Archyvas</h1>		<ul>
			<li><a href='http://www.d-b.lt/2013/02/' title='February 2013'>February 2013</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2012/11/' title='November 2012'>November 2012</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2012/04/' title='April 2012'>April 2012</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/12/' title='December 2011'>December 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/03/' title='March 2011'>March 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/02/' title='February 2011'>February 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/09/' title='September 2010'>September 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/03/' title='March 2010'>March 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/01/' title='January 2010'>January 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/12/' title='December 2009'>December 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/11/' title='November 2009'>November 2009</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2009/10/' title='October 2009'>October 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/08/' title='August 2009'>August 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/07/' title='July 2009'>July 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2009/06/' title='June 2009'>June 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2009/03/' title='March 2009'>March 2009</a>&nbsp;(5)</li>
	<li><a href='http://www.d-b.lt/2009/02/' title='February 2009'>February 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/01/' title='January 2009'>January 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2008/11/' title='November 2008'>November 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/08/' title='August 2008'>August 2008</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2008/06/' title='June 2008'>June 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/05/' title='May 2008'>May 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/04/' title='April 2008'>April 2008</a>&nbsp;(5)</li>
	<li><a href='http://www.d-b.lt/2008/03/' title='March 2008'>March 2008</a>&nbsp;(9)</li>
	<li><a href='http://www.d-b.lt/2008/02/' title='February 2008'>February 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/01/' title='January 2008'>January 2008</a>&nbsp;(11)</li>
	<li><a href='http://www.d-b.lt/2007/12/' title='December 2007'>December 2007</a>&nbsp;(12)</li>
		</ul>
</section>
</nav>
<section id="content" role="main">


	    <article class="post singular" id="post-83">
	<header class="clearfix">
		<h1><a href="http://www.d-b.lt/2009/03/hasfocus-ir-activeelement-uz-400-baitu.html" rel="bookmark">hasFocus ir activeElement už 400 baitų</a></h1>
		<ul>
			<li><time datetime="2009-03-07T21:42:16+00:00">2009 March 7</time></li>
					</ul>
	</header>

	<div class="postbody">
	<p>Vienas labiausiai internete užknisančių dalykų yra tai, kad kai kurios svetainės visiškai manęs negerbdamos paima ir perrašo įvesties laukų turinį tada kai aš jau ten bandau kažką rašyti. Ši situacija kyla iš to, kad nėra paprasto būdo nustatyti ar (ir kuris) HTML elementas yra fokusuotas ar ne. Internet Exploreris jau senokai turi <code>document.activeElement</code>, bet kas iš to, jeigu tai negalioja kitoms naršyklėms. HTML5 specifikacijoje yra standartizuotos abi -<code>element.hasFocus</code> ir <code>document.activeElement</code> galimybės, tačiau ką daryti šiandien? <a href="http://www.d-b.lt/2009/03/hasfocus-ir-activeelement-uz-400-baitu.html#galutinis-sprendimas-20090307">Tingiu skaityti &#8211; duok galutinį sprendimą</a>.</p>
<p>Aprašytos problemos sprendimo algoritmas yra gana paprastas &#8211; prikabinti <dfn title="event handler">įvykių gaudytojus</dfn> prie reikalingų elementų ir pačiam nustatyti reikalingus parametrus. Tačiau jeigu nesusimąstytume &#8211; greitas ir paprastas įgyvendimas turėtų kelias problemas.</p>
<p><span id="more-83"></span></p>
<h2>Sprendimo problemos</h2>
<p>Pavyzdys: krauname puslapį, jame yra paieškos laukas, kurio viduje yra tekstas &#8220;Paieška&#8221;. Fokusuojant lauką tas tekstas turi pradingti. Be abejo, pats &#8220;standartinio teksto&#8221; <i>patternas</i> yra jau savaime nelabai geras, tačiau kartais be jo tiesiog neįmanoma išsiversti. Taigi, turime du variantus: a) tekstą įrašyti lauke iš anksto (<code>input value="Paieška"</code>), fokusuojant jį ištrinti; b) palikti tuščią lauką, ir užkrovus puslapį tą tekstą įrašyti. Pirmu atveju turime semantikos problemą, o taipogi jis nėra <dfn title="unobtrusive">netrukdantis</dfn>, t.y. tam, kad naudotis lauku, reikalingas įjungtas Javascript. Taip pat, abiem atvejais, neįdėjus papildomų pastangų, perrašymas gali įvykti jau po to kai vartotojas fokusuoja lauką (pvz. dėl lėtai kraunamų Javascript bibliotekų arba IE6 paspaudus <i>refresh</i>, kai kursorius yra viename iš laukų).</p>
<p>Konkrečiam pavyzdžiui yra dar ir trečiasis variantas &#8211; naudoti <code>onfocus</code> ir <code>onblur</code> atributus ir Javascript rašyti tiesiog HTML viduje (<i>inline Javascript</i>), tačiau šis būdas tinkamas tik tuo atveju, jeigu nesilaikote <dfn title="HTML - markup">sužymėjimo</dfn> ir <dfn title="Javascript - behaviour">elgsenos</dfn> atskyrimo principo. Be to, jis apkrauna kiekvieną siunčiamą puslapį papildomu kodu, kas nėra pageidautina, ypač jeigu tokių laukų yra ne vienas. Na ir aišku, jis neišsprendžia pagrindės šio įrašo problemos &#8211; <code>hasFocus</code> &#8211; vieningu, paprastu, universaliu būdu.</p>
<h3>Kodo kiekis ir geriausios praktikos</h3>
<p>Akivaizdu, kad <code>hasFocus</code> simuliavimui reikės kiekviename puslapyje įtraukti gabaliuką Javascript, kuris priešingai negu geriausios praktikos rekomendacijos, turės būti įvykdomas dar prieš galutiniai &#8220;nupiešiant&#8221; puslapį, t.y. <code>&lt;head&gt;</code> viduje. Tai reiškia, kad pats kodas turi būti minimalus &#8211; tiek instrukcijų kiekiu, tiek savo apimtimi, nes kiekvienas persiųstas baitas ir vykdymas <a href="http://glinden.blogspot.com/2006/11/marissa-mayer-at-web-20.html">kainuoja vertingas milisekundes</a> (<a href="http://home.blarg.net/~glinden/StanfordDataMining.2006-11-29.ppt">prezentacija</a>).</p>
<h3>Įvykių burbuliavimas</h3>
<p>Su ankstesniu reikalavimu atsiranda ir kitas &#8211; neturime galimybės įvykių gaudyti kiekvienam elementui individualiai. Net jeigu tai ir nebūtų idelaus sprendimas vien dėl apkrovimo priežasčių, tie elementai dar paprasčiausiai neegzistuoja dokumente. Taigi turime rinktis <a href="http://code.google.com/p/reglib/">reglib</a> požiūrį &#8211; prikabinti savo funkcijas prie viso dokumento ir jų viduje nustatinėti elementą, kuriame viskas vyksta. Šioje vietoje derėtų paminėti, kad remiantis standartais, <code>focus</code> ir <code>blur</code> įvykiai neburbuliuoja į viršų, t.y. tėvinis elementas teoriškai neturėtų žinoti, kad jo vaikuose vyksta būtent šie įvykiai.</p>
<h3>Naršyklių skirtumai</h3>
<p>Skirtingos naršyklės <i>eventus</i> gaudo skirtingais būdais, taipogi naudoja skirtingą metodiką perduoti susiijusius elementus. Tradiciškai ši problema buvo sprendžiama vykdant skirtingas kodo šakas skirtingoms naršyklėms, tai nustant pagal <code>user-agent</code> eilutę. Tokia metodika yra žalinga ir nėra amžina. Pastaruoju metu tiek jQuery, tiek kitos bibliotekos perėjo prie efektyvesnio būdo &#8211; tikrinti ar egzistuoja tam tikros galimybės, o ne tikrinti ar lankytojas naudoja konkrečią naršyklę. <i>Feature sniffing</i> taipogi yra reikalavimas šiai užduočiai.</p>
<h2>Sprendimas pažingsniui</h2>
<ol>
<li>Nusistatom įvykių gaudymo funkciją (<i>f</i>) &#8211; IE naudoja <code>attachEvent</code>, padorios naršyklės &#8211; <code>addEventListener</code>.
<li>Nusistatom įvykių vardus (<i>n</i>). <code>focus</code> ir <code>blur</code> kaip minėjau neturėtų burbuliuoti į viršų, todėl su IE reikia naudoti <code>onfocusin</code> ir <code>onfocusout</code>. Šia tema <a href="http://www.quirksmode.org/dom/events/blurfocus.html">galima pasiskaityti ir daugiau</a>, tačiau šiam sprendimui šito užtenka.</li>
<li>Pagrindinė fokuso nustatymo funkcija (<i>s</i>) ima du parametrus &#8211; pirmas nurodo ar fokusą įjungti, ar atjungti, antrasis gi nurodo elementą.</li>
<li>Neesu įsitikinęs, kad čia pats taupiausias variantas, tačiau įdedame dvi funkcijas &#8211; viena gaudo <code>focus</code> (<i>i</i>), kita <code>blur</code> (<i>o</i>), ir kviečia pagrindinę funkciją.</li>
<li>Viską sukišame į <code>closure</code> ir sutrumpinę iki minimumo pagaliau prisegame įvykius &#8211; <code>d[f](n[0],i,true);</code>.</li>
</ol>
<h2 id="galutinis-sprendimas-20090307">Galutinis sprendimas</h2>
<pre>
(function() {
    var d = document,
	s = function(h, t) {
		if (t.tagName) {
			t.hasFocus=h;
			if (a) document.activeElement=t;
		}
	},
	i = function(e) {
		s(true, e.target || e.srcElement); },
	o = function(e) {
		s(false, e.target || e.srcElement); },
	f = d.addEventListener ?
		"addEventListener" : "attachEvent",
	n = typeof d.onfocusin=="object" ?
		['onfocusin','onfocusout'] : ['focus','blur'],
	a = typeof document.activeElement=="object" ?
		false : true;

	d[f](n[0],i,true); d[f](n[1],o,true);
})();
</pre>
<p>Panaikinus bereikalingus tarpus ir <a href="http://developer.yahoo.com/yui/compressor/">suspaudus viską į vieną eilutę</a>, šis sprendimas užimtų vos daugiau nei 400 baitų &#8211; pakankamai maža kaina už funkcionalumą. Jeigu netyčia nepalikau kokios klaidos kur nors &#8211; viskas turėtų veikti su IE6/7, FF2/3, Opera 9.6 ir Safari 3.x.</p>
<p>Taipogi galite pasižiūrėti <a href="http://code.dominykas.com/js/hasFocus.html">veikiančią demonstraciją</a>. Po dviejų sekundžių nuo užkrovimo gausite iššokantį langą, kuriame bus surašyta kas turi fokusą.</p>
	</div>

	<footer>
		<dl>
			<dt>Kategorija:</dt>
			<dd><a href="http://www.d-b.lt/category/it/tinklo-kurimas.html" title="View all posts in Tinklo kūrimas" rel="category tag">Tinklo kūrimas</a></dd>

			<dt>Žymos:</dt> <dd><ul><li><a href="http://www.d-b.lt/tag/eksperimentai.html" rel="tag">eksperimentai</a></li><li><a href="http://www.d-b.lt/tag/html.html" rel="tag">html</a></li><li><a href="http://www.d-b.lt/tag/html5.html" rel="tag">html5</a></li><li><a href="http://www.d-b.lt/tag/javascript.html" rel="tag">javascript</a></li><li><a href="http://www.d-b.lt/tag/kodas.html" rel="tag">kodas</a></li><li><a href="http://www.d-b.lt/tag/uzknisantys-dalykai-internete.html" rel="tag">užknisantys dalykai internete</a></li></ul></dd>
					</dl>
	</footer>


<!-- You can start editing here. -->

<section id="comments">
	<header class="withrss">
		<h1>One Response to &#8220;hasFocus ir activeElement už 400 baitų&#8221;</h1>
		<a href="http://www.d-b.lt/2009/03/hasfocus-ir-activeelement-uz-400-baitu.rss2.xml" class="rss" title="Komentarų RSS">Komentarų RSS</a>
	</header>


		<article class="comment  alt " id="comment-5219">
			<footer>
				 <img alt='&raquo; Eskizų paskirtis - Kaip tapti ekspertu?' src='http://www.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />				<cite><a href='http://www.d-b.lt/2009/08/eskizu-paskirtis.html' rel='external nofollow' class='url'>&raquo; Eskizų paskirtis - Kaip tapti ekspertu?</a></cite>


				<time datetime="2009-08-19T12:38:57+00:00"><a href="#comment-5219" title="">
					2009 August 19 at 12:38				</a></time>
			</footer>


			<p>[...] ar įmanoma, kad paprastos idėjos tiesiog veiktų (su visomis naršyklėmis) &#8211; tiek hasFocus/activeElement, tiek horizontalaus centravimo sprendimai gimė būtent iš [...]</p>

		</article>


	</section>



	</article>


</section>

<footer role="contentinfo" id="contentinfo">
	<p>&copy; 2005-2008, Dominykas Blyžė.</p>
	<p>Užduodu klausimus, neriu tinklus is proudly powered by <a href="http://wordpress.org/">WordPress</a>.</p>
</footer>


</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1761312-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>
