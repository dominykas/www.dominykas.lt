<!DOCTYPE html>
<html dir="ltr" lang="lt-LT">
<head>
	<meta charset="UTF-8" />

	<title>
		 &raquo; Formų validacija: netrukdyk man! - 		Užduodu klausimus, neriu tinklus			</title>

	<meta name="generator" content="WordPress 2.9.2" /> <!-- leave this for stats -->

	<link rel="stylesheet" href="http://www.d-b.lt/wp-content/themes/dominykas.com.5/style.css" type="text/css" />
	<link rel="pingback" href="http://www.d-b.lt/xmlrpc.php" />
	<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Feed" href="http://www.d-b.lt/index.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Comments Feed" href="http://www.d-b.lt/comments.rss2.xml" />
<link rel="alternate" type="application/rss+xml" title="Užduodu klausimus, neriu tinklus &raquo; Formų validacija: netrukdyk man! Comments Feed" href="http://www.d-b.lt/2009/07/formu-validacija-netrukdyk-man.rss2.xml" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.d-b.lt/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.d-b.lt/wp-includes/wlwmanifest.xml" />
<link rel='index' title='Užduodu klausimus, neriu tinklus' href='http://www.d-b.lt' />
<link rel='start' title='Labas, pasauli!' href='http://www.d-b.lt/2007/12/labas-pasauli.html' />
<link rel='prev' title='Kaip HTML5 įsisenėjusį skaudulį nuėmė' href='http://www.d-b.lt/2009/07/kaip-html5-isisenejusi-skauduli-nueme.html' />
<link rel='next' title='Eskizų paskirtis' href='http://www.d-b.lt/2009/08/eskizu-paskirtis.html' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel='canonical' href='http://www.d-b.lt/2009/07/formu-validacija-netrukdyk-man.html' />

	<link rel="openid.server" href="http://openid.claimid.com/server" />
	<link rel="openid.delegate" href="http://openid.claimid.com/dominykas" />

<!--[if IE]>
<script src="http://www.d-b.lt/wp-content/themes/dominykas.com.5/images/html5.js" type="text/javascript"></script>
<![endif]-->

</head>
<body><div id="page">

<header role="banner" id="banner">
	<hgroup>
		<h1><a href="http://www.d-b.lt/">Užduodu klausimus, neriu tinklus</a></h1>
		<h2>Dominykas Blyžė turi blog&#039;ą</h2>
	</hgroup>
</header>

<nav id="sidebar">

			<section id="recent-posts-2" class="widget widget_recent_entries">		<h1>Recent Posts</h1>		<ul>
				<li><a href="http://www.d-b.lt/2013/02/robots-txt-mitai-ir-neteisingas-naudojimas.html" title="robots.txt mitai ir neteisingas naudojimas">robots.txt mitai ir neteisingas naudojimas </a></li>
				<li><a href="http://www.d-b.lt/2012/11/ateikit-i-vilnius-js-susitikima.html" title="Ateikit į Vilnius JS susitikimą">Ateikit į Vilnius JS susitikimą </a></li>
				<li><a href="http://www.d-b.lt/2012/04/ateikit-i-infoshow-web-konferencija-2012.html" title="Ateikit į InfoShow WEB konferenciją 2012">Ateikit į InfoShow WEB konferenciją 2012 </a></li>
				<li><a href="http://www.d-b.lt/2011/12/ispudziai-is-diskusijos-apie-internetini-balsavima.html" title="Įspūdžiai iš diskusijos apie internetinį balsavimą">Įspūdžiai iš diskusijos apie internetinį balsavimą </a></li>
				<li><a href="http://www.d-b.lt/2011/03/savaitgalio-eksperimentas-login-2011-programa-pritaikyta-mobiliems-telefonams.html" title="Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams">Savaitgalio eksperimentas: Login 2011 programa, pritaikyta mobiliems telefonams </a></li>
				</ul>
		</section><section id="linkcat-129" class="widget widget_links"><h1>Kiti mano dalykai</h1>
	<ul class='xoxo blogroll'>
<li><a href="http://www.dominykas.com/" rel="me">Blog In English</a></li>
<li><a href="https://github.com/h5o" rel="me">HTML5 santraukų generatorius</a></li>
<li><a href="http://code.dominykas.com/" rel="me">Truputis JS/CSS/PHP kodo</a></li>
<li><a href="http://twitter.com/dymonaz" rel="me">Twitter</a></li>

	</ul>
</section>
<section id="archives-2" class="widget widget_archive"><h1>Archyvas</h1>		<ul>
			<li><a href='http://www.d-b.lt/2013/02/' title='February 2013'>February 2013</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2012/11/' title='November 2012'>November 2012</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2012/04/' title='April 2012'>April 2012</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/12/' title='December 2011'>December 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/03/' title='March 2011'>March 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2011/02/' title='February 2011'>February 2011</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/09/' title='September 2010'>September 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/03/' title='March 2010'>March 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2010/01/' title='January 2010'>January 2010</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/12/' title='December 2009'>December 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/11/' title='November 2009'>November 2009</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2009/10/' title='October 2009'>October 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/08/' title='August 2009'>August 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/07/' title='July 2009'>July 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2009/06/' title='June 2009'>June 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2009/03/' title='March 2009'>March 2009</a>&nbsp;(5)</li>
	<li><a href='http://www.d-b.lt/2009/02/' title='February 2009'>February 2009</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2009/01/' title='January 2009'>January 2009</a>&nbsp;(3)</li>
	<li><a href='http://www.d-b.lt/2008/11/' title='November 2008'>November 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/08/' title='August 2008'>August 2008</a>&nbsp;(1)</li>
	<li><a href='http://www.d-b.lt/2008/06/' title='June 2008'>June 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/05/' title='May 2008'>May 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/04/' title='April 2008'>April 2008</a>&nbsp;(5)</li>
	<li><a href='http://www.d-b.lt/2008/03/' title='March 2008'>March 2008</a>&nbsp;(9)</li>
	<li><a href='http://www.d-b.lt/2008/02/' title='February 2008'>February 2008</a>&nbsp;(2)</li>
	<li><a href='http://www.d-b.lt/2008/01/' title='January 2008'>January 2008</a>&nbsp;(11)</li>
	<li><a href='http://www.d-b.lt/2007/12/' title='December 2007'>December 2007</a>&nbsp;(12)</li>
		</ul>
</section>
</nav>
<section id="content" role="main">


	    <article class="post singular" id="post-139">
	<header class="clearfix">
		<h1><a href="http://www.d-b.lt/2009/07/formu-validacija-netrukdyk-man.html" rel="bookmark">Formų validacija: netrukdyk man!</a></h1>
		<ul>
			<li><time datetime="2009-07-14T23:30:16+00:00">2009 July 14</time></li>
					</ul>
	</header>

	<div class="postbody">
	<p><cite>Alanas Cooperis</cite> savo knygose pastoviai kartoja, kad blogiausias dalykas, kurį galima padaryti vartotojui, tai priversti jį jaustis kvailu. Bene lengviausia šį &#8220;tikslą&#8221; pasiekti yra validacijoje &#8211; kiekvienas bereikalingas klaidos pranešimas ir kiekviena sistema, kuri man trukdo daryti dalykus mano būdu, tiesiog ir verčia mane daužyti galvą į sieną su klausimu &#8220;<i>Nu</i>, kodėl šito reikia?&#8221; Šiandien aptikau puikų to pavyzdį:</p>
<pre>function isNumberKey(evt)
{
     var charCode = (evt.which) ? evt.which : event.keyCode
     if (charCode > 31 &#038;&#038; (charCode < 48 || charCode > 57))
        return false;

     return true;
}</pre>
<p><span id="more-139"></span><br />
Ši funkcija naudojama kaip <code>onkeypress</code> <i>event handler</i>. Ką ji daro iš tikro? Kai įvesties lauke paspaudžiamas klavišas, kuris nėra skaičius, ir nėra vienas iš kontrolinių klavišų (<kbd>Enter</kbd>, <kbd>Backspace</kbd> ir tt), klavišo paspaudimas yra sustabdomas ir ignoruojamas. Konkrečiu atveju, man reikėjo įvesti svetainėje savo 8 skaitmenų prisijungimo kodą, na ir lyg būtų logiška, kad man nereikia spausti kitų klavišų, tik skaičius, ir po to <kbd>Tab</kbd>, kad įvesti slaptažodį. <strong>Netiesa!</strong></p>
<p>Visiškai galima kombinacija, kurią galiu įvesti yra <kbd>Ctrl+V</kbd>. Nes paprasčiausiai naudojuosi konkrečia svetaine kartą per metus, todėl prisijungimo vardą, kuris yra generuojamas automatiškai, galiu surasti tik el. pašto archyve. Ar tai veiks? Be abejo ne (išskyrus Chrome &#8211; nesigilinau kodėl), nes tokio paspaudimo atveju <code>charCode</code> bus lygus 118, t.y. &#8220;v&#8221; raidės ASCII kodas, ir mano <i>Paste</i> veiksmas bus sustabdytas.</p>
<h2>Patarimas: leisk vartotojui elgtis kaip jis įpratęs</h2>
<p>Galima, be abejo sakyti, kad prisijungimo formoje tokia validacija išvis nereikalinga, nes įvedus neteisingą vartotojo vardą (pvz. <code>' OR ''='</code>), prisijungti tiesiog nepavyks, su pranešimu &#8220;Neteisingas vartotojo vardas ir/arba slaptažodis&#8221;. Tačiau lygiai taip pat galima teigti, kad siekiama vartotoją apsaugoti nuo to klaidos pranešimo, arba, kad toks validacijos veikimas kai kuriais atvejais gali būti pageidautinas. <strong>Netiesa!</strong></p>
<h2>Patarimas: nepasikliauk naršyklės API</h2>
<p>Javascript palaikymas interneto naršyklėse yra labai ribotas. Jis negali suteikti standartinių OS galimybių, kaip pvz. garsinis signalas paspaudus netinkamą klavišą. Negana to, konkrečioje formoje nėra suteikiama jokių užuominų, kad &#8220;leidžiama įvesti tik skaičius&#8221; (tuo atveju galima būtų tiesiog keikti programuotoją, už neteisingą vykdymą). Tačiau net jeigu viso to implementacija būtų teisinga, o puslapis pateiktų visas užuominas apie tai, ką galima daryti ir ko negalima, vistiek aš pasisakyčiau prieš tokį dalyką, ir ne vien tik todėl, kad <a href="http://www.quirksmode.org/blog/archives/2009/03/testing_mobile_1.html#link10">Nokia telefonai neteisingai perduoda <code>keyCode</code></a>.</p>
<p>Dar vienas pavyzdys būtų validacijos vykdymas, kai nuspaudžiamas <kbd>Enter</kbd> klavišas &#8211; ši problema mane nervuoja pragare, kuris vadinamas <a href="http://www.o2.ie">o2.ie</a> kasdien. Kodėl? Ogi tiek Firefox, tiek Chrome (su Opera svetainė neveikia išvis) <i>autocomplete</i> pasirinkus reikšmę, ir paspaudus <kbd>Enter</kbd>, įvykis perduodamas į Javascript, todėl pasirinkęs iš sąrašo savo telefoną, gaunu malonų pranešimą, kad neįvedžiau slaptažodžio, nors dar net nespėjau prieiti iki to žingsnio!</p>
<h2>Patarimas: nedėk apribojimų ten, kur jie visiškai nereikalingi</h2>
<p>Problema slypi tame, kad ribojama mano veiksmų laisvė. Neverta to daryti. Štai pvz. <code>textarea</code> elementas neturi <code>maxlength</code> atributo &#8211; galima to palaikymą sukurti su JS, bet daug geresnis variantas yra tiesiog parodyti kiek yra likę galimų įvesti simbolių, o <strong>klaidos pranešimą rodyti tik tada, kai klaida yra <em>tikrai</em> padaryta</strong>. Įsivaizduokite, jei Twitter neleistų įvesti daugiau negu 140 simbolių ir nesuteiktų galimybės redaguoti tekstą tol, kol jis telpa į juos.</p>
<p>Lygiai taip ir šiuo validacijos atveju, derėtų leisti vartotojui spausti tuos klavišus, kuriuos jis nori spausti, o įvestus duomenis tikrinti tik tada, kai vartotojas pasako &#8220;taip, aš žinau, kad noriu tokius duomenis išsiųsti&#8221;, t.y. <code>onsubmit</code> įvykio metu, arba tiesiog <i>server-side</i>.</p>
	</div>

	<footer>
		<dl>
			<dt>Kategorija:</dt>
			<dd><a href="http://www.d-b.lt/category/it/tinklo-kurimas.html" title="View all posts in Tinklo kūrimas" rel="category tag">Tinklo kūrimas</a></dd>

			<dt>Žymos:</dt> <dd><ul><li><a href="http://www.d-b.lt/tag/javascript.html" rel="tag">javascript</a></li><li><a href="http://www.d-b.lt/tag/usability.html" rel="tag">usability</a></li><li><a href="http://www.d-b.lt/tag/uzknisantys-dalykai-internete.html" rel="tag">užknisantys dalykai internete</a></li></ul></dd>
					</dl>
	</footer>


<!-- You can start editing here. -->

<section id="comments">
	<header class="withrss">
		<h1>3 Responses to &#8220;Formų validacija: netrukdyk man!&#8221;</h1>
		<a href="http://www.d-b.lt/2009/07/formu-validacija-netrukdyk-man.rss2.xml" class="rss" title="Komentarų RSS">Komentarų RSS</a>
	</header>


		<article class="comment  alt " id="comment-5179">
			<footer>
				 <img alt='Pawka' src='http://www.gravatar.com/avatar/3f63fd1979812f994d8d4bdd9aaeaa6f?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite><a href='http://pawka.linija.net/' rel='external nofollow' class='url'>Pawka</a></cite>


				<time datetime="2009-07-15T12:21:57+00:00"><a href="#comment-5179" title="">
					2009 July 15 at 12:21				</a></time>
			</footer>


			<p>Teisingas straipsnis. Būtent Opera kūrėjų viena iš pagrindinių idėjų ir yra ši mintis &#8211; neriboti vartotojo veiksmų.</p>

		</article>



		<article class="comment  " id="comment-5187">
			<footer>
				 <img alt='Chionsas' src='http://www.gravatar.com/avatar/0b04806aa87bbc1e037f345594c7de7f?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite>Chionsas</cite>


				<time datetime="2009-07-25T16:47:00+00:00"><a href="#comment-5187" title="">
					2009 July 25 at 16:47				</a></time>
			</footer>


			<p>Server-side validacija lėtoka (reikia išsiųsti duomenis).<br />
Geriau prodingai validuoti javascriptu pirma leidžiant vartotojui įvesti ką jis nori, o tada pataisant klaidingai įvestus duomenis.<br />
Digits-only laukeliams aš naudoju daugmaž tokią funkciją:</p>
<p>function validate_number(input) {<br />
	return input.replace(new RegExp(&#8220;[^0-9]&#8220;, &#8220;g&#8221;), &#8221;);<br />
}</p>
<p>užmeti šitą onblur ir būna visai ok =]</p>

		</article>



		<article class="comment  alt ownercomment" id="comment-5188">
			<footer>
				 <img alt='Dominykas' src='http://www.gravatar.com/avatar/760ee07e2a7c2a05ac35a981276c6a29?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite><a href='http://www.d-b.lt' rel='external nofollow' class='url'>Dominykas</a></cite>


				<time datetime="2009-07-25T21:46:22+00:00"><a href="#comment-5188" title="">
					2009 July 25 at 21:46				</a></time>
			</footer>


			<p>Chionsai, netiesa. Taisyti vartotojų duomenų pačiam, automatiniu būdu <strong>negalima</strong>. Visų pirma todėl, kad vartotojas lieka nežinioje, kodėl ir kas nutiko. Be to gali gautis visai netikėtas rezultatas. Kad ir pvz. klasikinė &#8220;decimal separator&#8221; problema.</p>
<p>Daryti tai onblur yra dar blogiau, nes nu klasikinis pavyzdys &#8211; pildau formą, atėjau į lauką A, kažką padariau, perėjau į lauką B, laukas A pasikeitė ar gavo klaidos pranešimą, grįžau į jį nebaigęs pildyti lauko B &#8211; laukas B irgi gavo klaidos pranešimą. Negalima gąsdinti ir bauginti vartotojo. Ypač kai jis nebūtinai kaltas dėl to kas įvyko.</p>
<p>Gera validacija perspėja apie tai ko ji tikisi iš anksto (neįkyriu būdu), tada negavusi tai ko nori &#8211; perspėja ramiu (ambient) būdu, kad ne viskas ok (onblur), o veiksmų stabdymas turi vykti tik onsubmit.</p>

		</article>


	</section>



	</article>


</section>

<footer role="contentinfo" id="contentinfo">
	<p>&copy; 2005-2008, Dominykas Blyžė.</p>
	<p>Užduodu klausimus, neriu tinklus is proudly powered by <a href="http://wordpress.org/">WordPress</a>.</p>
</footer>


</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1761312-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body>
</html>
